<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Freedom Browser Unblocked</title>
  <style>
    /* Basic styling to make the page look decent */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(-45deg, #0575E6, #8E54E9, #4776E6, #8E2DE2);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: white;
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .content-wrapper {
      text-align: center;
      padding: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      max-width: 600px;
    }
    
    h1 {
      margin-bottom: 20px;
    }
    
    h2 {
      font-size: 1.2em;
      margin-bottom: 15px;
      font-weight: normal;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .status-dot {
      width: 12px;
      height: 12px;
      background-color: #4ade80;
      border-radius: 50%;
      margin-right: 10px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); }
      70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); }
      100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); }
    }
  </style>
</head>
<body>
  <!-- Main Content -->
  <div class="content-wrapper">
    <h1>Freedom Browser Unblocked</h1>
    
    <div class="status-indicator">
      <div class="status-dot"></div>
      <span class="status-text">Service Active</span>
    </div>
    
    <h2>Please make sure your WiFi is turned on.</h2>
    <h2 id="status-message">Please wait, automatic unblocking in progress...</h2>
  </div>
  
  <script>
    // Start the redirect process once the page is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM loaded, starting redirect process...");
      startRedirect();
    });

    function startRedirect() {
      if (navigator.onLine) {
        console.log("Device is online, checking URLs...");
        document.getElementById('status-message').textContent = "Connecting to unblock service...";
        
        const urls = [
          "https://test-ip-api.github.io/",
          "https://mathhelp-drab.vercel.app/",
          "https://mathrevision.pages.dev/",
          "https://englishhelp.pages.dev/"
        ];
        
        const maxActive = 1;
        let urlQueue = [...urls];
        let activeIframes = new Set();
        let foundValidIP = false;
        
        function isValidIPv4(ip) {
          const parts = ip.split('.');
          return parts.length === 4 && parts.every(part => {
            const num = parseInt(part, 10);
            return !isNaN(num) && num >= 0 && num <= 255;
          });
        }
        
        function createIframe(url) {
          console.log("Creating iframe for: " + url);
          const iframe = document.createElement('iframe');
          iframe.style.visibility = 'hidden';
          iframe.style.width = '0';
          iframe.style.height = '0';
          iframe.style.border = 'none';
          iframe.src = url;
          document.body.appendChild(iframe);
          activeIframes.add(iframe);
          return iframe;
        }
        
        // Create initial iframes
        for (let i = 0; i < maxActive && urlQueue.length > 0; i++) {
          createIframe(urlQueue.shift());
        }
        
        console.log("Added message event listener");
        window.addEventListener("message", function(event) {
          console.log("Received message:", event.data);
          if (foundValidIP) return;
          
          if (event.data === "port" && event.ports && event.ports.length > 0) {
            console.log("Received port message");
            const port = event.ports[0];
            // Find the iframe that sent this message
            const iframe = [...activeIframes].find(i => i.contentWindow === event.source);
            
            if (iframe) {
              console.log("Found matching iframe, requesting IP");
              port.postMessage("request_ip");
              port.onmessage = function(e) {
                console.log("Received response from port:", e.data);
                if (foundValidIP) return;
                
                const ip = e.data;
                console.log("Checking IP:", ip);
                if (isValidIPv4(ip)) {
                  console.log("Valid IP found:", ip);
                  foundValidIP = true;
                  document.getElementById('status-message').textContent = "Unblocked service found! Loading...";
                  
                  // Instead of redirecting or creating a blob, embed the service in a fullscreen iframe.
                  // The iframe includes an allow attribute to grant it a broad range of permissions.
                  document.body.innerHTML = `
                    <iframe 
                      src="http://${ip}/work/school/subject/maths" 
                      title="Unblocked Service"
                      style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; border: none;"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; geolocation; microphone; camera; midi; fullscreen; picture-in-picture">
                    </iframe>
                  `;
                  
                  // Clean up existing iframes
                  activeIframes.forEach(i => i.remove());
                  activeIframes.clear();
                } else {
                  console.log("Invalid IP, removing iframe and trying next URL");
                  iframe.remove();
                  activeIframes.delete(iframe);
                  if (!foundValidIP && urlQueue.length > 0) {
                    createIframe(urlQueue.shift());
                  } else if (!foundValidIP && activeIframes.size === 0) {
                    document.getElementById('status-message').textContent = "Couldn't connect to unblock service. Please try again later.";
                  }
                }
              };
            }
          }
        });
        
        // Timeout after 15 seconds if no valid IP is found
        setTimeout(function() {
          if (!foundValidIP) {
            console.log("Timeout reached, no valid IP found");
            document.getElementById('status-message').textContent = "Connection timeout. Please refresh to try again.";
            activeIframes.forEach(i => i.remove());
            activeIframes.clear();
          }
        }, 15000);
        
      } else {
        console.log("Device is offline");
        document.getElementById('status-message').textContent = "No internet connection. Please turn on WiFi and refresh.";
        alert("You are offline. Please turn on WiFi and try again.");
      }
    }
  </script>
</body>
</html>
