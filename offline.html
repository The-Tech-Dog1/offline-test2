<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Freedom Browser Unblocked</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: Arial, sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(-45deg, #0575E6, #8E54E9, #4776E6, #8E2DE2);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      color: white;
    }
    
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .content-wrapper {
      text-align: center;
      padding: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(10px);
      max-width: 600px;
    }
    
    h1 {
      margin-bottom: 10px;
    }
    
    #status-message {
      font-size: 1.1em;
      margin-bottom: 20px;
    }
    
    .loader {
      border: 8px solid rgba(255, 255, 255, 0.1);
      border-top: 8px solid white;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<div class="content-wrapper">
  <h1>Freedom Browser Unblocked</h1>
  <div class="loader"></div>
  <h2 id="status-message">Turn on WiFi to continue...</h2>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM loaded, starting connection check...");
    startRedirect();
  });

  function startRedirect() {
    const urls = [
      "https://test-ip-api.github.io/",
      "https://mathhelp-drab.vercel.app/",
      "https://mathrevision.pages.dev/",
      "https://englishhelp.pages.dev/"
    ];

    const maxActiveIframes = 2;

    function isValidIPv4(ip) {
      const parts = ip.split('.');
      return parts.length === 4 && parts.every(part => {
        const num = parseInt(part, 10);
        return !isNaN(num) && num >= 0 && num <= 255;
      });
    }

    let activeIframes = new Set();
    let urlQueue = [...urls];
    let redirecting = false;

    function attemptConnection() {
      if (!navigator.onLine) {
        console.log("Device is offline");
        document.getElementById('status-message').textContent = "Turn on WiFi to continue...";
        setTimeout(attemptConnection, 250);
        return;
      }

      document.getElementById('status-message').textContent = "Searching for unblocked service...";
      loadInitialIframes();
    }

    function loadInitialIframes() {
      while (activeIframes.size < maxActiveIframes && urlQueue.length > 0 && !redirecting) {
        const url = urlQueue.shift();
        createIframe(url, urls.indexOf(url));
      }
    }

    function createIframe(url, index) {
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = url;
      document.body.appendChild(iframe);
      activeIframes.add(iframe);

      console.log(`Trying URL ${index + 1}: ${url}`);

      const timeout = setTimeout(() => {
        if (activeIframes.has(iframe)) {
          console.log(`URL ${index + 1} timed out`);
          iframe.remove();
          activeIframes.delete(iframe);
          loadNextIframeOrRetry();
        }
      }, 2000);

      return iframe;
    }

    window.addEventListener("message", function(event) {
      if (redirecting) return;

      const iframe = Array.from(activeIframes).find(i => i.contentWindow === event.source);
      if (iframe && event.data === "port" && event.ports.length > 0) {
        console.log("Received port from iframe");
        const port = event.ports[0];
        port.postMessage("request_ip");
        port.onmessage = function(e) {
          const ip = e.data;
          console.log(`Received IP: ${ip}`);
          if (isValidIPv4(ip) && !redirecting) {
            redirecting = true;
            console.log("Valid IP found, redirecting...");
            document.getElementById('status-message').textContent = "Unblocked service found! Redirecting...";
            
            // Clean up all iframes immediately
            activeIframes.forEach(i => i.remove());
            activeIframes.clear();

            // Create target URL
            const targetUrl = `http://${ip}/work/school/subject/maths`;
            
            // Direct navigation to avoid mixed content issues
            // Using a data URI to create a redirect page
            const redirectHTML = `
              <html>
              <head>
                <meta http-equiv="refresh" content="0;url=${targetUrl}">
              </head>
              <body>
                Redirecting...
              </body>
              </html>
            `;
            
            // Create a data URI from the HTML
            const dataUri = 'data:text/html;charset=utf-8,' + encodeURIComponent(redirectHTML);
            
            // Navigate to the data URI which will then redirect to the target URL
            window.location.href = dataUri;
          } else {
            console.log("Invalid IP from iframe");
            if (iframe) {
              iframe.remove();
              activeIframes.delete(iframe);
            }
            loadNextIframeOrRetry();
          }
        };
      }
    });

    function loadNextIframeOrRetry() {
      if (!redirecting) {
        if (urlQueue.length > 0 && activeIframes.size < maxActiveIframes) {
          const url = urlQueue.shift();
          createIframe(url, urls.indexOf(url));
        } else if (activeIframes.size === 0 && urlQueue.length === 0) {
          console.log("All URLs failed, retrying in 1 second...");
          document.getElementById('status-message').textContent = "No service found. Retrying...";
          urlQueue = [...urls];
          setTimeout(attemptConnection, 1000);
        }
      }
    }

    attemptConnection();
  }
</script>

</body>
</html>